### 回流和重绘
---

回流一定会触发重绘，而重绘不一定触发回流。

#### 回流（重排）
以视区的大小为基础，布局通常从body开始，用每个元素的框模型属性排列所有body子孙元素的尺寸，为不知道其尺寸的替换元素（如图像）提供占位符空间，即计算他们在设备视口（viewport）内的确切位置和大小的阶段叫做回流。

#### 重绘
将渲染树的每个节点都转化为屏幕上的实际像素，这个阶段叫重绘节点。也就是在屏幕上绘制图形，但是如背景颜色发生变化，会引起重绘，但不会触发回流。

#### 触发回流和重绘的操作
1. 添加或者删除dom元素；
2. 改变dom原素的尺寸大小（宽、高、边距、边框等）；
3. 页面一开始加载的时候；
4. 元素的位置发生变化；
5. 浏览器窗口大小发生变化；

#### 浏览器的优化机制
由于每次重排（回流）都会造成额外的计算消耗，所以现代浏览器会通过队列化修改并批量执行来优化重排过程。但是在获取布局信息操作的时候，会强制队列刷新，比如访问以下属性或方法：
+ scrollTop、scrollLeft、scrollLeft、scrollHeight;
+ clientTop、clientLeft、clientLeft、clientHeight;
+ offsetTop、offsetLeft、offsetLeft、offsetHeight;
+ getComputedStyle();
+ getBoundingRect();
以上属性和方法都需要返回最新的布局信息，因此浏览器不得不清空队列，触发回流重绘来返回正确的值。因此我们在修改样式的时候，尽量避免使用这些属性，他们都会刷新渲染队列，如果要使用，最好将值缓存起来。

#### 减少回流和重绘的方法
1. 合并多个dom操作一起执行，element.style.cssText += ""; element.className += "";
2. 必须使用布局操作的时候，如offsetTop等，先把值保存起来再使用；
3. 使用浮动，float；绝对定位，absolute；固定定位，fixed；使节点脱离文档流，display: none；


#### 扩展：display: none; visibility: hidden; opacity: 0 的区别

--- |display: none|visibility: hidden|opacity: 0 |
:-:|:-:|:-:|:-:|:-:|
页面中 | 不存在 | 存在 | 存在 |
重排 | 会 | 不会 | 不会 |
重绘 | 会 | 会 | 不一定 |
自身绑定事件 | 不触发 | 不触发 | 可触发 |
transition | 不支持 | 支持 | 支持 |
子元素可复原 | 不能 | 能 | 不能 |
被遮挡的元素可触发事件 | 能 | 能 | 不能 |