(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{527:function(e,t,s){e.exports=s.p+"assets/img/hooks1.f00b4245.jpg"},591:function(e,t,s){"use strict";s.r(t);var n=s(76),o=Object(n.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"react-hooks"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#react-hooks"}},[e._v("#")]),e._v(" React-Hooks:")]),e._v(" "),n("p",[e._v("æ˜¯å‡½æ•°ç»„ä»¶è§£å†³æ²¡æœ‰stateï¼Œç”Ÿå‘½å‘¨æœŸï¼Œé€»è¾‘ä¸èƒ½å¤ç”¨çš„ä¸€ç§æŠ€æœ¯æ–¹æ¡ˆã€‚")]),e._v(" "),n("p",[e._v("Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚")]),e._v(" "),n("h2",{attrs:{id:"functionå’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#functionå’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«"}},[e._v("#")]),e._v(" functionå’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("class Index extends Component<any,any>{\n    constructor(props){\n        super(props)\n        this.state = {\n            num: 0\n        }\n    }\n    handleClick = () => {\n        for(let i=0; i< 5; i++ ){\n            setTimeout(()=>{\n                this.setState({number: this.state.num+1})\n                console.log(this.state.num)\n            }, 1000)\n        }\n    }\n    render() {\n        return <div>\n            <div onClick={this.handleClick}>num++</div>\n        </div>\n    }\n}\nexport default Index;\n")])])]),n("p",[e._v("æ‰“å°ç»“æœï¼š 1 2 3 4 5")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function Index () {\n    const [num, setNumber] = React.useState(0)\n    const handleClick = () => {\n        for(let i=0; i<5; i++){\n            setTimeout(()=>{\n                setNumber(num+1)\n                console.log(num)\n            }, 1000)\n        }\n    }\n    return <div onClick={handleClick}>{num}</div>\n}\n")])])]),n("p",[e._v("æ‰“å°ç»“æœï¼š0 0 0 0 0")]),e._v(" "),n("p",[n("strong",[e._v("å¯¹äºclassç»„ä»¶ï¼Œåªéœ€è¦å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå®ä¾‹ä¸­ä¿å­˜äº†stateç­‰çŠ¶æ€ï¼Œæ¯æ¬¡æ›´æ–°åªéœ€è¦è°ƒç”¨renderæ–¹æ³•å³å¯ã€‚ä½†æ˜¯åœ¨functionç»„ä»¶ä¸­ï¼Œæ¯ä¸€æ¬¡æ›´æ–°éƒ½æ˜¯ä¸€æ¬¡æ–°çš„å‡½æ•°æ‰§è¡Œï¼Œä¸ºäº†ä¿å­˜ä¸€äº›çŠ¶æ€ï¼Œæ‰§è¡Œä¸€äº›å‰¯ä½œç”¨é’©å­ï¼Œreact-hooksåº”è¿è€Œç”Ÿï¼Œå»å¸®åŠ©ç»„ä»¶è®°å½•ä¸€äº›çŠ¶æ€ï¼Œå¤„ç†ä¸€äº›é¢å¤–çš„å‰¯ä½œç”¨ã€‚")])]),e._v(" "),n("h2",{attrs:{id:"hooksåˆå§‹åŒ–"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hooksåˆå§‹åŒ–"}},[e._v("#")]),e._v(" Hooksåˆå§‹åŒ–ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("useState  // è´Ÿè´£ç»„ä»¶æ›´æ–°\nuseEffect // æ‰§è¡Œå‰¯ä½œç”¨\nuseRef    // ä¿å­˜æ•°æ®\nuseMemo   // ç¼“å­˜ä¼˜åŒ–\n\nuseCallback\nuseReducer\nuseLayoutEffect\n")])])]),n("p",[e._v("ç¤ºä¾‹ä»£ç ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("import React, { useState, useEffect, useMemo, useRef } from 'react';\n\nfunction Index() {\n    const [number, setNumber] = useState(0);\n    const divDemo = useMemo(() => <div>hello, I am a divDemo.</div>, [])\n    const curRef = useRef(null);\n    useEffect(()=>{\n        console.log(curRef.current)\n    },[])\n    return <div ref={ curRef }>\n        hello world { number }\n        { divDemo }\n        <button onClick={() => setNumber(number+1)}>number ++</button>\n    </div>\n}\n")])])]),n("ol",[n("li",[n("strong",[e._v("mountWorkInProgressHook")])])]),e._v(" "),n("p",[e._v("åœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ¯ä¸€æ¬¡hooksæ‰§è¡Œï¼Œå¦‚useState(), useEffect(), éƒ½ä¼šè°ƒç”¨mountWorkInProgressHook.")]),e._v(" "),n("p",[e._v("mountWorkInProgressHookåšçš„äº‹æƒ…ï¼šé¦–å…ˆæ¯æ¬¡æ‰§è¡Œä¸€ä¸ªhookså‡½æ•°ï¼Œéƒ½äº§ç”Ÿä¸€ä¸ªhookså¯¹è±¡ï¼Œé‡Œé¢ä¿å­˜äº†å½“å‰hookä¿¡æ¯ï¼Œç„¶åå°†æ¯ä¸ªhooksä»¥é“¾è¡¨å½¢å¼ä¸²è”èµ·æ¥ï¼Œå¹¶èµ‹å€¼ç»™workInProgressçš„memoizedStateã€‚ä¹Ÿå°±è¯æ˜äº†å‡½æ•°ç»„ä»¶ç”¨memoizedStateå­˜æ”¾hooksé“¾è¡¨ã€‚")]),e._v(" "),n("ul",[n("li",[e._v("memoizedState:\n"),n("ul",[n("li",[e._v("useStateï¼šä¿å­˜stateä¿¡æ¯")]),e._v(" "),n("li",[e._v("useEffectï¼šä¿å­˜effectå¯¹è±¡")]),e._v(" "),n("li",[e._v("useRefï¼šä¿å­˜refå¯¹è±¡")]),e._v(" "),n("li",[e._v("useMemoï¼šä¿å­˜ç¼“å­˜çš„å€¼å’Œdeps")])])]),e._v(" "),n("li",[e._v("baseQueue: useStateå’ŒuseEffectä¸­ä¿å­˜æœ€æ–°çš„æ›´æ–°é˜Ÿåˆ—ã€‚")]),e._v(" "),n("li",[e._v("baseState: useStateå’ŒuseEffectä¸­ï¼Œä¸€æ¬¡æ›´æ–°ä¸­ï¼Œäº§ç”Ÿçš„æœ€æ–°çš„stateå€¼ã€‚")]),e._v(" "),n("li",[e._v("queue: ä¿å­˜å¾…æ›´æ–°é˜Ÿåˆ—pendingQueueï¼Œæ›´æ–°å‡½æ•°dispatchç­‰ä¿¡æ¯ã€‚")]),e._v(" "),n("li",[e._v("next: æŒ‡å‘ä¸‹ä¸€ä¸ªhookså¯¹è±¡ã€‚\n"),n("div",{staticStyle:{"text-align":"center"}},[n("img",{attrs:{width:"100%",src:s(527),alt:""}})])])]),e._v(" "),n("p",[n("strong",[e._v("ä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ä¸­å£°æ˜hooks:")]),e._v(" å› ä¸ºä¸€æ—¦åœ¨æ¡ä»¶è¯­å¥ä¸­å£°æ˜hooksï¼Œåœ¨ä¸‹ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ›´æ–°ï¼Œhooksé“¾è¡¨ç»“æ„ï¼Œå°†ä¼šè¢«ç ´åï¼Œcurrentæ ‘çš„memoizedStateç¼“å­˜hooksä¿¡æ¯ï¼Œå’Œå½“å‰workInProgressä¸ä¸€è‡´ï¼Œå¦‚æœæ¶‰åŠåˆ°è¯»å–stateç­‰æ“ä½œï¼Œå°±ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚")]),e._v(" "),n("p",[n("font",{attrs:{color:"#dd0000"}},[e._v("ğŸŒŸæ€»ç»“ï¼šhooksæ˜¯é€šè¿‡ä»€ä¹ˆè¯æ˜å”¯ä¸€æ€§çš„ï¼Ÿç­”ï¼šé€šè¿‡hooksé“¾è¡¨é¡ºåºã€‚")])],1),e._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("strong",[e._v("useState => mountState")])])]),e._v(" "),n("p",[e._v("åœ¨æ— çŠ¶æ€ç»„ä»¶ä¸­ï¼ŒuseStateå’ŒuseReducerè§¦å‘å‡½æ•°æ›´æ–°çš„æ–¹æ³•éƒ½æ˜¯dispatchActionï¼ŒuseStateå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªç®€ç‰ˆçš„useReducerã€‚")]),e._v(" "),n("p",[e._v("dispatchActionæ— çŠ¶æ€ç»„ä»¶æ›´æ–°æœºåˆ¶: dispatchActionå°±æ˜¯setNumberã€‚")]),e._v(" "),n("ul",[n("li",[e._v("æ— è®ºæ˜¯ç±»ç»„ä»¶è°ƒç”¨setStateï¼Œè¿˜æ˜¯å‡½æ•°ç»„ä»¶çš„dispatchActionï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªupdateå¯¹è±¡ï¼Œé‡Œé¢è®°å½•äº†æ­¤æ¬¡æ›´æ–°çš„ä¿¡æ¯ï¼Œç„¶åå°†æ­¤updateæ”¾å…¥å¾…æ›´æ–°çš„pendingé˜Ÿåˆ—ä¸­ã€‚dispatchActionçš„ç¬¬äºŒæ­¥å°±æ˜¯åˆ¤æ–­å½“å‰å‡½æ•°ç»„ä»¶çš„fiberå¯¹è±¡æ˜¯å¦å¤„äºæ¸²æŸ“é˜¶æ®µã€‚å¦‚æœå¤„äºæ¸²æŸ“é˜¶æ®µï¼Œé‚£ä¹ˆä¸éœ€è¦æˆ‘ä»¬æ›´æ–°å½“å‰å‡½æ•°ç»„ä»¶ï¼Œåªéœ€è¦æ›´æ–°å½“å‰çš„updateå’ŒexpirationTimeå³å¯ã€‚")]),e._v(" "),n("li",[e._v("å¦‚æœå½“å‰fiberæ²¡æœ‰å¤„äºæ›´æ–°é˜¶æ®µï¼Œé‚£ä¹ˆé€šè¿‡è°ƒç”¨lastRenderedReducerè·å–æœ€æ–°stateï¼Œå’Œä¸Šä¸€æ¬¡çš„currentStateè¿›è¡Œæµ…æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œå°±é€€å‡ºã€‚è¯å®äº†useStateä¸¤æ¬¡å€¼ç›¸ç­‰çš„æ—¶å€™ç»„ä»¶å°±ä¸è¿›è¡Œæ¸²æŸ“äº†ï¼Œè¿™å’ŒComponentæ¨¡å¼ä¸‹çš„setStateæœ‰ä¸€å®šçš„åŒºåˆ«ã€‚")]),e._v(" "),n("li",[e._v("å¦‚æœä¸¤æ¬¡stateä¸ç›¸ç­‰ï¼Œè°ƒç”¨scheduleUpdateOnFiberè°ƒåº¦æ¸²æŸ“å½“å‰fiberï¼Œ"),n("font",{attrs:{color:"#dd0000"}},[e._v("scheduleUpdateOnFiber")]),e._v("æ˜¯reactæ¸²æŸ“æ›´æ–°çš„ä¸»è¦å‡½æ•°ã€‚")],1)]),e._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[n("strong",[e._v("useEffect => mountEffect")])])]),e._v(" "),n("p",[e._v("æ¯ä¸ªhooksåˆå§‹åŒ–éƒ½ä¼šåˆ›å»ºä¸€ä¸ªhookå¯¹è±¡ï¼Œç„¶åå°†hookçš„memoizedStateä¿å­˜å½“å‰çš„effect hookä¿¡æ¯ã€‚")]),e._v(" "),n("p",[e._v("æœ‰ä¸¤ä¸ªmemoizedStateä¸è¦æ··æ·†")]),e._v(" "),n("ul",[n("li",[e._v("workInProgress / current æ ‘ä¸Šçš„memoizedStateä¿å­˜çš„æ˜¯å½“å‰å‡½æ•°ç»„ä»¶æ¯ä¸ªhookså½¢æˆçš„é“¾è¡¨ã€‚")]),e._v(" "),n("li",[e._v("æ¯ä¸ªhooksä¸Šçš„memoizedStateä¿å­˜çš„æ˜¯å½“å‰hooksçš„ä¿¡æ¯ï¼Œä¸åŒç§ç±»çš„hooksçš„memoizedStateå†…å®¹ä¸åŒã€‚")])]),e._v(" "),n("p",[e._v("pushEffect åˆ›å»º effect å¯¹è±¡ï¼ŒæŒ‚è½½ updateQueue")]),e._v(" "),n("p",[e._v("é¦–å…ˆåˆ›å»ºä¸€ä¸ª effect ï¼Œåˆ¤æ–­ç»„ä»¶å¦‚æœç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œé‚£ä¹ˆåˆ›å»º componentUpdateQueue ï¼Œå°±æ˜¯workInProgressçš„updateQueueã€‚ç„¶åå°†effectæ”¾å…¥updateQueueä¸­ã€‚")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function pushEffect(tag, create, destroy, deps) {\n  const effect = {\n    tag,\n    create,\n    destroy,\n    deps,\n    next: null,\n  };\n  let componentUpdateQueue = currentlyRenderingFiber.updateQueue\n  if (componentUpdateQueue === null) { // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ª useEffect\n    componentUpdateQueue = {  lastEffect: null  }\n    currentlyRenderingFiber.updateQueue = componentUpdateQueue\n    componentUpdateQueue.lastEffect = effect.next = effect;\n  } else {  // å­˜åœ¨å¤šä¸ªeffect\n    const lastEffect = componentUpdateQueue.lastEffect;\n    if (lastEffect === null) {\n      componentUpdateQueue.lastEffect = effect.next = effect;\n    } else {\n      const firstEffect = lastEffect.next;\n      lastEffect.next = effect;\n      effect.next = firstEffect;\n      componentUpdateQueue.lastEffect = effect;\n    }\n  }\n  return effect;\n}\n")])])]),n("p",[e._v("å†…å®¹å¤ªå¤šï¼Œå…ˆä¸å†™äº†â€¦â€¦ğŸ˜­")]),e._v(" "),n("p",[n("strong",[e._v("mounted é˜¶æ®µ hooks æ€»ç»“")])]),e._v(" "),n("p",[e._v("åˆå§‹åŒ–é˜¶æ®µï¼Œreact-hooks åšçš„äº‹æƒ…ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰§è¡Œä¸Šä¸‹æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ª react-hooks æ‰§è¡Œï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª hook å¯¹è±¡ï¼Œå¹¶å½¢æˆé“¾è¡¨ç»“æ„ï¼Œç»‘å®šåœ¨ workInProgress çš„ memoizedState å±æ€§ä¸Šï¼Œç„¶å react-hooks ä¸Šçš„çŠ¶æ€ï¼Œç»‘å®šåœ¨å½“å‰ hooks å¯¹è±¡çš„ memoizedState å±æ€§ä¸Šã€‚å¯¹äº effect å‰¯ä½œç”¨é’©å­ï¼Œä¼šç»‘å®šåœ¨ workInProgress.updateQueue ä¸Šï¼Œç­‰åˆ° commit é˜¶æ®µï¼Œdom æ ‘æ„å»ºå®Œæˆï¼Œåœ¨æ‰§è¡Œæ¯ä¸ª effect å‰¯ä½œç”¨é’©å­ã€‚")]),e._v(" "),n("h2",{attrs:{id:"hooks-æ›´æ–°é˜¶æ®µ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hooks-æ›´æ–°é˜¶æ®µ"}},[e._v("#")]),e._v(" Hooks æ›´æ–°é˜¶æ®µ")]),e._v(" "),n("p",[e._v("å¯¹äºæ›´æ–°é˜¶æ®µï¼Œè¯´æ˜ä¸Šä¸€æ¬¡ workInProgress æ ‘å·²ç»èµ‹å€¼ç»™äº† current æ ‘ã€‚å­˜æ”¾hooksä¿¡æ¯çš„memoizedStateï¼Œæ­¤æ—¶å·²ç»å­˜åœ¨currentæ ‘ä¸Šï¼Œreactå¯¹äºhooksçš„å¤„ç†é€»è¾‘å’Œfiberæ ‘é€»è¾‘ç±»ä¼¼ã€‚")]),e._v(" "),n("p",[e._v("å¯¹äºä¸€æ¬¡å‡½æ•°ç»„ä»¶æ›´æ–°ï¼Œå½“å†æ¬¡æ‰§è¡Œhookså‡½æ•°çš„æ—¶å€™ï¼Œæ¯”å¦‚ useState(0) ï¼Œé¦–å…ˆè¦ä»currentçš„hooksä¸­æ‰¾åˆ°ä¸å½“å‰workInProgressHookï¼Œå¯¹åº”çš„currentHooksï¼Œç„¶åå¤åˆ¶ä¸€ä»½currentHooksç»™workInProgressHook,æ¥ä¸‹æ¥hookså‡½æ•°æ‰§è¡Œçš„æ—¶å€™,æŠŠæœ€æ–°çš„çŠ¶æ€æ›´æ–°åˆ°workInProgressHookï¼Œä¿è¯hooksçŠ¶æ€ä¸ä¸¢å¤±ã€‚")]),e._v(" "),n("h2",{attrs:{id:"useeffect-ä¸æ”¯æŒå…³é”®è¯-async-çš„åŸå› "}},[n("a",{staticClass:"header-anchor",attrs:{href:"#useeffect-ä¸æ”¯æŒå…³é”®è¯-async-çš„åŸå› "}},[e._v("#")]),e._v(" useEffect ä¸æ”¯æŒå…³é”®è¯ async çš„åŸå› ")]),e._v(" "),n("p",[e._v("ä½¿ç”¨ async/await å…³é”®è¯ï¼Œä¼šè¿”å›ä¸€ä¸ªpromisesï¼ŒuseEffect çš„è¿”å›çš„ä¹Ÿå°±æ˜¯ promise äº†ã€‚")]),e._v(" "),n("p",[e._v("æ­£ç¡®çš„å†™æ³•æ˜¯åœ¨ useEffect å†…å†™ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œç„¶åè°ƒç”¨å®ƒã€‚")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("useEffect(() => {\n    const fetchData = async () => {\n        try {\n            const res = await fetch('xxx/url');\n            const data = await res.json();\n        } catch (e) {\n            console.error('Error: ', error);\n        }\n    };\n\n    fetchData();\n}, [])\n\n")])])]),e._v(" "),n("comment-comment")],1)}),[],!1,null,null,null);t.default=o.exports}}]);